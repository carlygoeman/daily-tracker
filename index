<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<title>Daily Tracker</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body { background: #0f0f13; color: #fff; font-family: 'Inter', system-ui, sans-serif; min-height: 100vh; }
  #root { max-width: 480px; margin: 0 auto; padding: 0 16px 60px; }
  input[type="date"] { color-scheme: dark; }
  input:focus { outline: none; border-color: #7c3aed !important; }
  button:active { opacity: 0.7; }
  ::-webkit-scrollbar { width: 0; }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect } = React;

const defaultHabits = [
  { id: 1, name: "Workout", emoji: "ðŸ‹ï¸" },
  { id: 2, name: "Meditate", emoji: "ðŸ§˜" },
  { id: 3, name: "Early protein", emoji: "ðŸ¥©" },
  { id: 4, name: "No alcohol", emoji: "ðŸš«ðŸ·" },
  { id: 5, name: "Bed by 10", emoji: "ðŸ˜´" },
];

const ratingLabels = { "-2": "Rough", "-1": "Meh", "0": "Neutral", "1": "Pretty good", "2": "Amazing" };
const ratingEmoji = { "-2": "ðŸ˜ž", "-1": "ðŸ˜", "0": "ðŸ™‚", "1": "ðŸ˜Š", "2": "ðŸŒŸ" };

function getTodayKey() { return new Date().toISOString().split("T")[0]; }

function App() {
  const [habits, setHabits] = useState(() => { try { const v = localStorage.getItem("dt_habits"); return v ? JSON.parse(v) : defaultHabits; } catch(e) { return defaultHabits; } });
  const [goalCount, setGoalCount] = useState(() => { try { const v = localStorage.getItem("dt_goal"); return v ? JSON.parse(v) : 3; } catch(e) { return 3; } });
  const [days, setDays] = useState(() => { try { const v = localStorage.getItem("dt_days"); return v ? JSON.parse(v) : {}; } catch(e) { return {}; } });
  const [selectedDate, setSelectedDate] = useState(getTodayKey());
  const [newHabit, setNewHabit] = useState("");
  const [newTask, setNewTask] = useState("");
  const [view, setView] = useState("today");

  const today = getTodayKey();

  useEffect(() => { localStorage.setItem("dt_habits", JSON.stringify(habits)); }, [habits]);
  useEffect(() => { localStorage.setItem("dt_goal", JSON.stringify(goalCount)); }, [goalCount]);
  useEffect(() => { localStorage.setItem("dt_days", JSON.stringify(days)); }, [days]);

  function getDay(k) { return days[k] || { checks: {}, tasks: [], rating: null }; }

  function toggleHabit(id) {
    const d = getDay(selectedDate);
    setDays(p => ({ ...p, [selectedDate]: { ...d, checks: { ...d.checks, [id]: !d.checks[id] } } }));
  }

  function setRating(val) {
    const d = getDay(selectedDate);
    setDays(p => ({ ...p, [selectedDate]: { ...d, rating: d.rating === val ? null : val } }));
  }

  function addTask() {
    if (!newTask.trim()) return;
    const d = getDay(selectedDate);
    setDays(p => ({ ...p, [selectedDate]: { ...d, tasks: [...d.tasks, { id: Date.now(), text: newTask.trim(), done: false }] } }));
    setNewTask("");
  }

  function toggleTask(id) {
    const d = getDay(selectedDate);
    setDays(p => ({ ...p, [selectedDate]: { ...d, tasks: d.tasks.map(t => t.id === id ? { ...t, done: !t.done } : t) } }));
  }

  function removeTask(id) {
    const d = getDay(selectedDate);
    setDays(p => ({ ...p, [selectedDate]: { ...d, tasks: d.tasks.filter(t => t.id !== id) } }));
  }

  function addHabit() {
    if (!newHabit.trim()) return;
    setHabits(p => [...p, { id: Date.now(), name: newHabit.trim(), emoji: "âœ“" }]);
    setNewHabit("");
  }

  function removeHabit(id) { setHabits(p => p.filter(h => h.id !== id)); }

  const day = getDay(selectedDate);
  const checkedCount = habits.filter(h => day.checks[h.id]).length;
  const progress = habits.length > 0 ? checkedCount / habits.length : 0;
  const hitGoal = checkedCount >= goalCount;

  const historyDays = Object.keys(days)
    .filter(k => { const d = days[k]; return (d.checks && Object.values(d.checks).some(Boolean)) || d.rating != null; })
    .sort((a, b) => b.localeCompare(a))
    .slice(0, 30);

  const S = {
    header: { display: "flex", justifyContent: "space-between", alignItems: "center", padding: "20px 0 12px" },
    h1: { fontSize: 22, fontWeight: 700 },
    tabRow: { display: "flex", gap: 8 },
    tab: (active) => ({ padding: "6px 14px", borderRadius: 20, border: "none", background: active ? "#7c3aed" : "#1e1e2a", color: "#fff", fontSize: 13, cursor: "pointer", fontWeight: 600 }),
    dateRow: { display: "flex", alignItems: "center", gap: 10, marginBottom: 20 },
    dateInput: { background: "#1e1e2a", color: "#aaa", border: "1px solid #2a2a3a", borderRadius: 8, padding: "8px 10px", fontSize: 14, flex: 1 },
    todayBtn: { background: "#7c3aed", color: "#fff", border: "none", borderRadius: 8, padding: "8px 12px", fontSize: 13, cursor: "pointer", fontWeight: 600, whiteSpace: "nowrap" },
    card: { background: "#1e1e2a", borderRadius: 14, padding: "14px 16px", marginBottom: 16 },
    cardMuted: { background: "#1a1a24", borderRadius: 14, padding: "14px 16px", marginBottom: 16, border: "1px solid #2a2a3a" },
    label: { fontSize: 11, fontWeight: 700, color: "#666", textTransform: "uppercase", letterSpacing: 1, marginBottom: 8 },
    labelMuted: { fontSize: 11, fontWeight: 700, color: "#555", textTransform: "uppercase", letterSpacing: 1, marginBottom: 10 },
    progressRow: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 8 },
    progressTrack: { background: "#0f0f13", borderRadius: 6, height: 8, overflow: "hidden" },
    habitRow: { display: "flex", alignItems: "center", gap: 12, padding: "14px 0", borderBottom: "1px solid #1e1e2a", cursor: "pointer", userSelect: "none", WebkitUserSelect: "none" },
    checkbox: (checked) => ({ width: 26, height: 26, borderRadius: 8, border: checked ? "none" : "2px solid #333", background: checked ? "#7c3aed" : "transparent", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0, transition: "all 0.15s" }),
    habitName: (checked) => ({ fontSize: 16, color: checked ? "#aaa" : "#fff", textDecoration: checked ? "line-through" : "none", flex: 1, transition: "all 0.15s" }),
    removeBtn: { background: "none", border: "none", color: "#333", fontSize: 16, cursor: "pointer", padding: "4px 6px" },
    inputRow: { display: "flex", gap: 8, marginTop: 10 },
    input: { flex: 1, background: "#1e1e2a", border: "1px solid #2a2a3a", borderRadius: 8, color: "#fff", padding: "10px 12px", fontSize: 14 },
    inputMuted: { flex: 1, background: "#0f0f13", border: "1px solid #2a2a3a", borderRadius: 8, color: "#fff", padding: "8px 10px", fontSize: 13 },
    addBtn: { background: "#7c3aed", border: "none", borderRadius: 8, color: "#fff", padding: "0 14px", fontSize: 18, cursor: "pointer" },
    addBtnMuted: { background: "#333", border: "none", borderRadius: 8, color: "#aaa", padding: "0 12px", fontSize: 16, cursor: "pointer" },
    taskRow: { display: "flex", alignItems: "center", gap: 10, padding: "8px 0" },
    taskCheck: (done) => ({ width: 20, height: 20, borderRadius: 5, border: done ? "none" : "1.5px solid #444", background: done ? "#555" : "transparent", display: "flex", alignItems: "center", justifyContent: "center", cursor: "pointer", flexShrink: 0 }),
    taskText: (done) => ({ flex: 1, fontSize: 14, color: done ? "#444" : "#999", textDecoration: done ? "line-through" : "none" }),
    ratingRow: { display: "flex", justifyContent: "space-between" },
    ratingBtn: (val, active) => ({ flex: 1, padding: "10px 0", background: active ? (val >= 1 ? "#166534" : val === 0 ? "#1e3a5f" : "#5f1e1e") : "transparent", border: "1px solid " + (active ? (val >= 1 ? "#4ade80" : val === 0 ? "#60a5fa" : "#f87171") : "#2a2a3a"), borderRadius: 10, color: "#fff", cursor: "pointer", display: "flex", flexDirection: "column", alignItems: "center", gap: 4, transition: "all 0.15s", margin: "0 2px" }),
  };

  return (
    <div>
      <div style={S.header}>
        <h1 style={S.h1}>Daily Tracker</h1>
        <div style={S.tabRow}>
          <button onClick={() => setView("today")} style={S.tab(view === "today")}>Today</button>
          <button onClick={() => setView("history")} style={S.tab(view === "history")}>History</button>
        </div>
      </div>

      {view === "today" ? (
        <>
          <div style={S.dateRow}>
            <input type="date" value={selectedDate} onChange={e => setSelectedDate(e.target.value)} style={S.dateInput} />
            {selectedDate !== today && <button onClick={() => setSelectedDate(today)} style={S.todayBtn}>Today</button>}
          </div>

          {/* Progress */}
          <div style={S.card}>
            <div style={S.progressRow}>
              <span style={{ fontSize: 13, color: "#aaa" }}>{checkedCount} / {habits.length} habits</span>
              <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
                <span style={{ fontSize: 12, color: "#666" }}>Goal:</span>
                <button onClick={() => setGoalCount(Math.max(1, goalCount - 1))} style={{ background: "none", border: "none", color: "#7c3aed", fontSize: 18, cursor: "pointer", lineHeight: 1, padding: "0 4px" }}>âˆ’</button>
                <span style={{ fontSize: 14, color: hitGoal ? "#4ade80" : "#fff", fontWeight: 700, minWidth: 18, textAlign: "center" }}>{goalCount}</span>
                <button onClick={() => setGoalCount(Math.min(habits.length, goalCount + 1))} style={{ background: "none", border: "none", color: "#7c3aed", fontSize: 18, cursor: "pointer", lineHeight: 1, padding: "0 4px" }}>+</button>
              </div>
            </div>
            <div style={S.progressTrack}>
              <div style={{ height: "100%", width: `${progress * 100}%`, background: hitGoal ? "linear-gradient(90deg,#4ade80,#22c55e)" : "linear-gradient(90deg,#7c3aed,#a78bfa)", borderRadius: 6, transition: "width 0.3s ease" }} />
            </div>
            {hitGoal && <div style={{ marginTop: 6, fontSize: 12, color: "#4ade80", fontWeight: 600 }}>ðŸŽ¯ Goal hit!</div>}
          </div>

          {/* Habits */}
          <div style={{ marginBottom: 8 }}>
            <div style={S.label}>Habits</div>
            {habits.map(h => (
              <div key={h.id} onClick={() => toggleHabit(h.id)} style={S.habitRow}>
                <div style={S.checkbox(day.checks[h.id])}>
                  {day.checks[h.id] && <span style={{ color: "#fff", fontSize: 14 }}>âœ“</span>}
                </div>
                <span style={S.habitName(day.checks[h.id])}>{h.emoji} {h.name}</span>
                <button onClick={e => { e.stopPropagation(); removeHabit(h.id); }} style={S.removeBtn}>Ã—</button>
              </div>
            ))}
            <div style={S.inputRow}>
              <input value={newHabit} onChange={e => setNewHabit(e.target.value)} onKeyDown={e => e.key === "Enter" && addHabit()} placeholder="Add a habit..." style={S.input} />
              <button onClick={addHabit} style={S.addBtn}>+</button>
            </div>
          </div>

          {/* Tasks */}
          <div style={{ ...S.cardMuted, marginTop: 20 }}>
            <div style={S.labelMuted}>Today's Tasks</div>
            {day.tasks.length === 0 && <div style={{ fontSize: 13, color: "#444", marginBottom: 6 }}>Nothing here yet</div>}
            {day.tasks.map(t => (
              <div key={t.id} style={S.taskRow}>
                <div onClick={() => toggleTask(t.id)} style={S.taskCheck(t.done)}>
                  {t.done && <span style={{ color: "#aaa", fontSize: 11 }}>âœ“</span>}
                </div>
                <span style={S.taskText(t.done)}>{t.text}</span>
                <button onClick={() => removeTask(t.id)} style={{ ...S.removeBtn, fontSize: 14 }}>Ã—</button>
              </div>
            ))}
            <div style={{ ...S.inputRow, marginTop: 8 }}>
              <input value={newTask} onChange={e => setNewTask(e.target.value)} onKeyDown={e => e.key === "Enter" && addTask()} placeholder="Add a task..." style={S.inputMuted} />
              <button onClick={addTask} style={S.addBtnMuted}>+</button>
            </div>
          </div>

          {/* Rating */}
          <div style={S.card}>
            <div style={S.label}>How was your day?</div>
            <div style={S.ratingRow}>
              {[-2,-1,0,1,2].map(val => (
                <button key={val} onClick={() => setRating(val)} style={S.ratingBtn(val, day.rating === val)}>
                  <span style={{ fontSize: 20 }}>{ratingEmoji[val]}</span>
                  <span style={{ fontSize: 10, color: day.rating === val ? "#fff" : "#666" }}>{val > 0 ? "+" : ""}{val}</span>
                </button>
              ))}
            </div>
            {day.rating != null && <div style={{ marginTop: 8, fontSize: 13, color: "#aaa", textAlign: "center" }}>{ratingLabels[day.rating]}</div>}
          </div>
        </>
      ) : (
        <div>
          <div style={S.label}>Recent Days</div>
          {historyDays.length === 0 && <div style={{ fontSize: 14, color: "#444", textAlign: "center", padding: 40 }}>No history yet â€” start checking off habits!</div>}
          {historyDays.map(dk => {
            const d = days[dk];
            const checks = habits.filter(h => d.checks && d.checks[h.id]);
            const pct = habits.length > 0 ? checks.length / habits.length : 0;
            const isToday = dk === today;
            const date = new Date(dk + "T12:00:00");
            const label = isToday ? "Today" : date.toLocaleDateString("en", { weekday: "short", month: "short", day: "numeric" });
            return (
              <div key={dk} style={{ background: "#1e1e2a", borderRadius: 12, padding: "12px 14px", marginBottom: 8 }}>
                <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6 }}>
                  <span style={{ fontSize: 13, color: isToday ? "#7c3aed" : "#aaa", fontWeight: isToday ? 700 : 500 }}>{label}</span>
                  <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
                    {d.rating != null && <span style={{ fontSize: 16 }}>{ratingEmoji[d.rating]}</span>}
                    <span style={{ fontSize: 12, color: checks.length >= goalCount ? "#4ade80" : "#666" }}>{checks.length}/{habits.length}</span>
                  </div>
                </div>
                <div style={{ background: "#0f0f13", borderRadius: 4, height: 5, overflow: "hidden" }}>
                  <div style={{ height: "100%", width: `${pct * 100}%`, background: pct >= goalCount / habits.length ? "#4ade80" : "#7c3aed", borderRadius: 4 }} />
                </div>
              </div>
            );
          })}
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
